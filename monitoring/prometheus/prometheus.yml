# @format

# Prometheus Configuration
global:
  scrape_interval: 15s # How often to scrape targets
  evaluation_interval: 15s # How often to evaluate rules
  external_labels:
    cluster: "local-dev"
    environment: "development"

# Alertmanager configuration (optional)
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093
      scheme: http
      timeout: 10s
      api_version: v2

# Load rules once and periodically evaluate them
rule_files:
  - "alerts.yml"

# Scrape configurations
scrape_configs:
  # Prometheus itself
  - job_name: "prometheus"
    honor_timestamps: true
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: /metrics
    scheme: http
    body_size_limit: "0"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"

  # Node Exporter - System metrics
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          service: "node-exporter"
          instance: "local-machine"

  # cAdvisor - Container metrics
  - job_name: "cadvisor"
    static_configs:
      - targets: ["cadvisor:8080"]
        labels:
          service: "cadvisor"
          instance: "local-docker"

  # Your Next.js application (if it exposes metrics)
  # Uncomment and adjust when you add metrics to your app
  - job_name: "nextjs-app"
    metrics_path: /api/metrics
    static_configs:
      - targets: ["host.docker.internal:3000"]
        labels:
          service: "nextjs"
          environment: "development"

  # ========================================
  # Cross-Account Scraping (Pipeline Account)
  # ========================================
  # These targets are scraped via VPC peering from the pipeline account
  # Update the IP addresses after deploying each environment

  # Development Environment - Node Exporter
  # IP will be updated by scripts/monitoring/setup-cross-account-scraping.sh
  # - job_name: 'node-exporter-development'
  #   static_configs:
  #     - targets: ['10.1.x.x:9100']  # Update with dev instance IP
  #       labels:
  #         service: 'node-exporter'
  #         environment: 'development'
  #         account: 'development'

  # Staging Environment - Node Exporter (future)
  # - job_name: 'node-exporter-staging'
  #   static_configs:
  #     - targets: ['10.2.x.x:9100']
  #       labels:
  #         service: 'node-exporter'
  #         environment: 'staging'
  #         account: 'staging'

  # Production Environment - Node Exporter (future)
  # - job_name: 'node-exporter-production'
  #   static_configs:
  #     - targets: ['10.3.x.x:9100']
  #       labels:
  #         service: 'node-exporter'
  #         environment: 'production'
  #         account: 'production'
